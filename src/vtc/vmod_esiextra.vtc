varnishtest "Generate an ETag as the hash of the received body"

server s1 {
	rxreq
	txresp -body "foo"
} -start

varnish v1 -vcl+backend {
	import esiextra;

	sub vcl_backend_response {
	    esiextra.bodyhash(beresp.http.ETag);
	}
} -start

client c1 -repeat 3 {
	txreq
	rxresp
	expect resp.http.ETag == {"2c26b46b68ffc68ff99b453c1d30413413422d706483bfa0f98a5e886266e7ae"}
} -run
